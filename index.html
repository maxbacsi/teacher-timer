<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Science-Themed Classroom Timer</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&display=swap');

    :root {
      --coa-gold: #FFC72C;
      --coa-dark-red: #8B0000;
      --coa-eggshell: #F5F5DC;
      --schedule-highlight1: #8B0000; /* dark red */
      --schedule-highlight1-bg: rgba(139, 0, 0, 0.9);
      --schedule-highlight2: #B22222; /* firebrick red */
      --schedule-highlight2-bg: rgba(178, 34, 34, 0.8);
      --class-highlight1: #C71585; /* medium violet red */
      --class-highlight1-bg: rgba(199, 21, 133, 0.2);
      --class-highlight2: #FF69B4; /* hot pink */
      --class-highlight2-bg: rgba(255, 105, 180, 0.2);
      --class-highlight3: #DB7093; /* pale violet red */
      --class-highlight3-bg: rgba(219, 112, 147, 0.2);
      --class-highlight4: #FF1493; /* deep pink */
      --class-highlight4-bg: rgba(255, 20, 147, 0.2);
      --eggshell: #F5F5DC;
    }

    html, body {
      margin: 0;
      padding: 30px 40px 50px 40px;
      box-sizing: border-box;
      font-family: 'Comic Neue', cursive, sans-serif;
      background: white url('https://static.vecteezy.com/system/resources/previews/026/757/327/non_2x/science-seamless-pattern-with-doodles-cartoon-elements-supplies-on-white-background-for-wallpaper-wrapping-paper-stationary-prints-scrapbooking-etc-back-to-school-theme-eps-10-vector.jpg') repeat;
      background-size: 300px 300px;
      color: #2c3e50;
      min-height: 100vh;
      user-select: none;
      position: relative;
      overflow: hidden;
    }

    /* DRAGGABLE CONTAINERS */
    .draggable {
      position: absolute;
      border: 2px solid #000;
      background: var(--coa-dark-red);
      border-radius: 18px;
      box-shadow: 0 10px 20px rgba(139, 0, 0, 0.4), inset 0 0 50px rgba(139, 0, 0, 0.5);
      color: var(--coa-gold);
      box-sizing: border-box;
      resize: both;
      overflow: auto;
      z-index: 1000;
      display: flex;
      flex-direction: column;
    }

    /* RESIZE HANDLES */
    .resize-handle {
      position: absolute;
      width: 16px;
      height: 16px;
      background: #000;
      z-index: 10;
    }
    .resize-handle.br { bottom: 0; right: 0; cursor: se-resize; }
    .resize-handle.bl { bottom: 0; left: 0; cursor: sw-resize; }
    .resize-handle.tr { top: 0; right: 0; cursor: ne-resize; }
    .resize-handle.tl { top: 0; left: 0; cursor: nw-resize; }

    /* DRAG HEADER */
    .drag-header {
      cursor: move;
      background: rgba(0, 0, 0, 0.25);
      padding: 7px 10px;
      font-weight: 700;
      font-size: 1.15em;
      user-select: none;
      border-top-left-radius: 16px;
      border-top-right-radius: 16px;
      color: var(--coa-gold);
      text-shadow: 1px 1px 1px #4a0000;
    }

    /* DATE BOX */
    #date-container {
      width: max-content;
      padding: 10px 28px;
      background: var(--coa-dark-red);
      box-shadow: 0 8px 15px rgba(0,0,0,0.4), inset 0 0 40px #8B0000;
      border-radius: 18px;
      color: black;
      font-weight: 700;
      font-size: 1.45em;
      text-shadow: none;
      user-select: none;
      white-space: nowrap;
    }
    #date-display {
      color: white;
      text-shadow: 0 0 3px black;
    }

    /* COLUMN BASE */
    .column {
      width: 420px;
      padding: 28px 38px 38px 38px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    /* HEADINGS */
    h1 {
      margin: 0;
      font-size: 2.6em;
      color: var(--coa-gold);
      text-align: center;
      font-weight: 700;
      text-shadow: 1px 1px 1px #5f0000cc;
      user-select: none;
      letter-spacing: 0.05em;
    }

    /* Schedule and Class container styling */
    #schedule-column, #class-column {
      background: var(--coa-dark-red);
      border-radius: 18px;
      box-shadow: 0 10px 25px rgba(139, 0, 0, 0.5), inset 0 0 60px rgba(139, 0, 0, 0.6);
      overflow-y: auto;
    }

    /* Segment rows */
    .segment-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 18px;
      font-weight: 700;
      font-size: 1.3em;
      border-radius: 12px;
      user-select: none;
      transition: background-color 0.4s ease, color 0.4s ease;
    }

    /* Schedule highlights */
    .schedule-normal {
      color: var(--coa-gold);
      background: transparent;
    }
    .schedule-highlight {
      color: var(--coa-gold);
      background-color: var(--coa-eggshell);
    }

    /* Different colors for schedule highlights */
    .schedule-1 {
      background-color: var(--schedule-highlight1-bg);
      color: var(--coa-gold);
    }
    .schedule-1.highlight {
      background-color: var(--coa-eggshell);
      color: var(--schedule-highlight1);
    }

    .schedule-2 {
      background-color: var(--schedule-highlight2-bg);
      color: var(--coa-gold);
    }
    .schedule-2.highlight {
      background-color: var(--coa-eggshell);
      color: var(--schedule-highlight2);
    }

    /* Class timer segments - different highlight colors */
    .class-segment {
      color: var(--coa-gold);
      background-color: transparent;
      transition: background-color 0.4s ease, color 0.4s ease;
    }
    .class-settled {
      background-color: var(--class-highlight1-bg);
      color: var(--coa-gold);
    }
    .class-settled.highlight {
      background-color: var(--class-highlight1);
      color: var(--coa-gold);
    }

    .class-mini {
      background-color: var(--class-highlight2-bg);
      color: var(--coa-gold);
    }
    .class-mini.highlight {
      background-color: var(--class-highlight2);
      color: var(--coa-gold);
    }

    .class-work1 {
      background-color: var(--class-highlight3-bg);
      color: var(--coa-gold);
    }
    .class-work1.highlight {
      background-color: var(--class-highlight3);
      color: var(--coa-gold);
    }

    .class-break {
      background-color: var(--class-highlight4-bg);
      color: var(--coa-gold);
    }
    .class-break.highlight {
      background-color: var(--class-highlight4);
      color: var(--coa-gold);
    }

    /* Layout for segments label and timer */
    .segment-label {
      flex: 1 1 auto;
    }
    .segment-time {
      width: 80px;
      text-align: right;
      font-variant-numeric: tabular-nums;
      font-weight: 900;
      letter-spacing: 0.03em;
    }

    /* Music frame */
    #music-column {
      width: 260px;
      height: 140px;
      padding: 0;
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,0.6);
      background: black;
      border: 2px solid #000;
      display: flex;
      flex-direction: column;
    }
    #music-column iframe {
      width: 100%;
      height: 100%;
      border: none;
      pointer-events: auto;
      user-select: none;
      border-radius: 0 0 18px 18px;
    }
    #music-column .drag-header {
      cursor: move;
      background: rgba(0,0,0,0.3);
      padding: 5px 10px;
      font-weight: 700;
      color: #fff;
      text-shadow: none;
      border-radius: 18px 18px 0 0;
      user-select: none;
    }

  </style>
</head>
<body>

  <div class="draggable" id="date-container" style="top: 20px; left: 20px;">
    <div class="drag-header">Date</div>
    <div id="date-display"></div>
    <div class="resize-handle tl"></div>
    <div class="resize-handle tr"></div>
    <div class="resize-handle bl"></div>
    <div class="resize-handle br"></div>
  </div>

  <div class="draggable column" id="schedule-column" style="top: 100px; left: 40px;">
    <div class="drag-header">Today's Schedule</div>
    <h1>Today's Schedule</h1>
    <div id="schedule"></div>
    <div class="resize-handle tl"></div>
    <div class="resize-handle tr"></div>
    <div class="resize-handle bl"></div>
    <div class="resize-handle br"></div>
  </div>

  <div class="draggable column" id="class-column" style="top: 100px; left: 520px;">
    <div class="drag-header">Today's Class</div>
    <h1>Today's Class</h1>
    <div id="class-timer"></div>
    <div class="resize-handle tl"></div>
    <div class="resize-handle tr"></div>
    <div class="resize-handle bl"></div>
    <div class="resize-handle br"></div>
  </div>

  <div class="draggable music-frame" id="music-column" style="top: 20px; right: 20px;">
    <div class="drag-header">Lofi</div>
    <iframe
      src="https://www.youtube.com/embed/jfKfPfyJRdk?autoplay=0&controls=1&modestbranding=1&rel=0&loop=1&playlist=jfKfPfyJRdk"
      title="Lofi Hip Hop Radio"
      allow="autoplay; encrypted-media"
      allowfullscreen
    ></iframe>
    <div class="resize-handle tl"></div>
    <div class="resize-handle tr"></div>
    <div class="resize-handle bl"></div>
    <div class="resize-handle br"></div>
  </div>

  <script>
    // Drag and Resize Implementation
    (function() {
      const draggables = document.querySelectorAll('.draggable');
      draggables.forEach(el => {
        const header = el.querySelector('.drag-header');
        const handles = {
          tl: el.querySelector('.resize-handle.tl'),
          tr: el.querySelector('.resize-handle.tr'),
          bl: el.querySelector('.resize-handle.bl'),
          br: el.querySelector('.resize-handle.br'),
        };
        let dragActive = false, resizeActive = false;
        let startX, startY, startWidth, startHeight, startLeft, startTop;
        let currentHandle = null;

        // Dragging
        header.addEventListener('mousedown', e => {
          e.preventDefault();
          dragActive = true;
          const rect = el.getBoundingClientRect();
          startX = e.clientX;
          startY = e.clientY;
          startLeft = rect.left;
          startTop = rect.top;
          document.body.style.userSelect = 'none';
        });

        // Resizing
        Object.entries(handles).forEach(([key, handle]) => {
          handle.addEventListener('mousedown', e => {
            e.preventDefault();
            resizeActive = true;
            currentHandle = key;
            const rect = el.getBoundingClientRect();
            startX = e.clientX;
            startY = e.clientY;
            startWidth = rect.width;
            startHeight = rect.height;
            startLeft = rect.left;
            startTop = rect.top;
            document.body.style.userSelect = 'none';
          });
        });

        document.addEventListener('mousemove', e => {
          if (dragActive) {
            let newLeft = startLeft + e.clientX - startX;
            let newTop = startTop + e.clientY - startY;
            // keep within viewport horizontally
            newLeft = Math.max(0, Math.min(newLeft, window.innerWidth - el.offsetWidth));
            // keep within viewport vertically
            newTop = Math.max(0, Math.min(newTop, window.innerHeight - el.offsetHeight));
            el.style.left = newLeft + 'px';
            el.style.top = newTop + 'px';
          } else if (resizeActive) {
            let dx = e.clientX - startX;
            let dy = e.clientY - startY;
            let newWidth = startWidth;
            let newHeight = startHeight;
            let newLeft = startLeft;
            let newTop = startTop;

            switch (currentHandle) {
              case 'br':
                newWidth = startWidth + dx;
                newHeight = startHeight + dy;
                break;
              case 'bl':
                newWidth = startWidth - dx;
                newHeight = startHeight + dy;
                newLeft = startLeft + dx;
                break;
              case 'tr':
                newWidth = startWidth + dx;
                newHeight = startHeight - dy;
                newTop = startTop + dy;
                break;
              case 'tl':
                newWidth = startWidth - dx;
                newHeight = startHeight - dy;
                newLeft = startLeft + dx;
                newTop = startTop + dy;
                break;
            }
            // Minimum size limits
            if (newWidth < 250) newWidth = 250;
            if (newHeight < 80) newHeight = 80;

            // Keep inside viewport horizontally
            if (newLeft < 0) newLeft = 0;
            if (newTop < 0) newTop = 0;
            if (newLeft + newWidth > window.innerWidth) newWidth = window.innerWidth - newLeft;
            if (newTop + newHeight > window.innerHeight) newHeight = window.innerHeight - newTop;

            el.style.width = newWidth + 'px';
            el.style.height = newHeight + 'px';
            el.style.left = newLeft + 'px';
            el.style.top = newTop + 'px';
          }
        });

        document.addEventListener('mouseup', () => {
          dragActive = false;
          resizeActive = false;
          currentHandle = null;
          document.body.style.userSelect = 'auto';
        });
      });
    })();

    // === Date display ===
    function updateDate() {
      const dateDiv = document.getElementById('date-display');
      const now = new Date();
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      dateDiv.textContent = now.toLocaleDateString(undefined, options);
    }
    updateDate();
    setInterval(updateDate, 60 * 1000);

    // === Today's Schedule and Today's Class ===

    // Schedule blocks with start/end times in 24h format (HH:MM)
    // Times are strings; parse and convert to minutes from midnight to compare easily.
    const dailySchedule = [
      { name: '1st Period', start: '09:15', end: '10:30' },
      { name: '2nd Period', start: '10:30', end: '11:45' },
      { name: 'Lunch', start: '11:45', end: '12:10' },
      { name: '3rd Period', start: '12:10', end: '13:25' },
      { name: 'Crew', start: '13:25', end: '14:20' },
      { name: '4th Period', start: '14:20', end: '15:35' },
    ];

    // Class segments for periods (except Lunch and Crew)
    // Each block is 75 minutes total broken down
    // 5m Settled, 15m Mini-lesson, 20m Work 1, 5m Break, 30m Work 2
    const classSegments = [
      { name: 'Get Settled', duration: 5, className: 'class-settled' },
      { name: 'Mini Lesson', duration: 15, className: 'class-mini' },
      { name: 'Work Time 1', duration: 20, className: 'class-work1' },
      { name: 'Break', duration: 5, className: 'class-break' },
      { name: 'Work Time 2', duration: 30, className: 'class-work1' },
    ];

    // Special countdowns for Lunch and Crew
    const lunchDuration = 25; // minutes
    const crewDuration = 55;  // minutes

    // Convert HH:MM to minutes from midnight
    function timeStrToMinutes(t) {
      const [h, m] = t.split(':').map(Number);
      return h * 60 + m;
    }

    // Format mm:ss
    function formatTimeLeft(totalSeconds) {
      const m = Math.floor(totalSeconds / 60);
      const s = totalSeconds % 60;
      return `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    }

    // Get total minutes now
    function getCurrentMinutes() {
      const now = new Date();
      return now.getHours() * 60 + now.getMinutes() + now.getSeconds() / 60;
    }

    // Update schedule display and highlight current period
    function updateSchedule() {
      const scheduleDiv = document.getElementById('schedule');
      const now = new Date();
      const nowMinutes = now.getHours() * 60 + now.getMinutes() + now.getSeconds() / 60;

      let scheduleHtml = '';
      dailySchedule.forEach((block, i) => {
        const startMin = timeStrToMinutes(block.start);
        const endMin = timeStrToMinutes(block.end);
        const isCurrent = nowMinutes >= startMin && nowMinutes < endMin;
        const highlightClass = isCurrent ? 'highlight' : '';
        // Alternate schedule colors between 1 and 2 classes for color scheme
        const colorClass = i % 2 === 0 ? 'schedule-1' : 'schedule-2';
        scheduleHtml += `
          <div class="segment-row schedule-${colorClass} ${highlightClass}">
            <div>${block.name}</div>
            <div>${block.start} - ${block.end}</div>
          </div>`;
      });
      scheduleDiv.innerHTML = scheduleHtml;
    }

    // Update Today's Class timer with segments or lunch/crew countdown
    function updateClassTimer() {
      const classDiv = document.getElementById('class-timer');
      const now = new Date();
      const nowMinutes = now.getHours() * 60 + now.getMinutes() + now.getSeconds() / 60;

      // Find current block in schedule
      let currentBlock = null;
      for (const block of dailySchedule) {
        const startMin = timeStrToMinutes(block.start);
        const endMin = timeStrToMinutes(block.end);
        if (nowMinutes >= startMin && nowMinutes < endMin) {
          currentBlock = block;
          break;
        }
      }

      if (!currentBlock) {
        classDiv.innerHTML = '<div style="text-align:center; font-weight:bold; font-size:1.4em;">No class now</div>';
        return;
      }

      // Handle Lunch and Crew countdown simple timers
      if (currentBlock.name === 'Lunch') {
        const startMin = timeStrToMinutes(currentBlock.start);
        const elapsed = (nowMinutes - startMin) * 60;
        const total = lunchDuration * 60;
        const left = Math.max(0, Math.floor(total - elapsed));
        classDiv.innerHTML = `
          <div class="segment-row class-break highlight" style="justify-content:center; font-size:1.6em;">
            <div>Lunch Time</div>
            <div>${formatTimeLeft(left)}</div>
          </div>`;
        return;
      } else if (currentBlock.name === 'Crew') {
        const startMin = timeStrToMinutes(currentBlock.start);
        const elapsed = (nowMinutes - startMin) * 60;
        const total = crewDuration * 60;
        const left = Math.max(0, Math.floor(total - elapsed));
        classDiv.innerHTML = `
          <div class="segment-row class-break highlight" style="justify-content:center; font-size:1.6em;">
            <div>Crew Time</div>
            <div>${formatTimeLeft(left)}</div>
          </div>`;
        return;
      }

      // For periods: build full segment list with times relative to block start
      const blockStart = timeStrToMinutes(currentBlock.start) * 60;
      const nowSec = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();

      let elapsedSec = nowSec - blockStart;

      // Clamp elapsedSec between 0 and total duration of classSegments
      const totalDurationSec = classSegments.reduce((sum,s) => sum + s.duration * 60, 0);
      if (elapsedSec < 0) elapsedSec = 0;
      if (elapsedSec > totalDurationSec) elapsedSec = totalDurationSec;

      let html = '';
      let segmentStart = 0;

      for (const seg of classSegments) {
        const segDurationSec = seg.duration * 60;
        const segEnd = segmentStart + segDurationSec;
        const timeLeft = segmentStart <= elapsedSec && elapsedSec < segEnd
          ? Math.max(0, Math.floor(segEnd - elapsedSec))
          : (elapsedSec < segmentStart ? segDurationSec : 0);

        const isCurrent = elapsedSec >= segmentStart && elapsedSec < segEnd;
        const segmentClass = seg.className + (isCurrent ? ' highlight' : '');
        const textColor = isCurrent ? seg.className.replace('-bg','') : '';
        // If highlighted, use solid color for text
        const textStyle = isCurrent ? `color: var(--${seg.className.replace('class-','')});` : '';

        html += `<div class="segment-row class-segment ${segmentClass}" style="${textStyle}">
          <div class="segment-label">${seg.name}</div>
          <div class="segment-time">${formatTimeLeft(timeLeft)}</div>
        </div>`;

        segmentStart += segDurationSec;
      }

      classDiv.innerHTML = html;
    }

    // Update loop every second
    function loop() {
      updateSchedule();
      updateClassTimer();
    }
    loop();
    setInterval(loop, 1000);
  </script>
</body>
</html>

